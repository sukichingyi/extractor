<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event & Lesson Lists</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8fafc; }
    .tab-bar {
      display: flex; border-bottom: 2px solid #ccc; background: #f5f5f5; padding-left: 10px;
    }
    .tab { padding: 14px 24px; cursor: pointer; border: none; background: none; font-size: 1.15rem; color: #555;
      outline: none; border-bottom: 2px solid transparent; transition: background .2s, border-color .2s; }
    .tab.active { color: #0066cc; border-bottom: 2px solid #0066cc; background: #fff; }
    .page { display: none; padding: 20px; }
    .page.active { display: block; }

    /* General */
    textarea { width: 100%; height: 200px; padding: 10px; font-size: 1rem; margin-bottom: 10px; box-sizing: border-box; }
    button { padding: 6px 12px; font-size: 0.9rem; border: none; border-radius: 4px; background: #0066cc; color: #fff; cursor: pointer; margin: 4px; }
    button:hover { background: #004d99; }
    .danger { background:#cc0000!important; }
    .calendar-btn { background:#28a745; }
    .calendar-btn:hover { background:#1e7e34; }
    .modify-btn { background:#ff9900; }
    .modify-btn:hover { background:#e68a00; }
    .pink-btn { background:#ff66cc; }
    .pink-btn:hover { background:#e055b4; }

    /* Event page */
    .list { margin-top:20px; padding:15px; background:#fff; border:1px solid #ddd; border-radius:6px; }
    .list-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; flex-wrap:wrap; }
    .list h3 { margin:0; font-size:1rem; background:#444; color:#fff; padding:5px 10px; border-radius:4px; white-space:nowrap; }
    .header-buttons button { margin-left:4px; }
    .event-wrapper{display:flex;gap:10px;}
    .event-content{flex:3;}
    .calc-panel{flex:1;padding:10px;border:1px dashed #888;background:#f0f8ff;border-radius:4px;}
    .calc-hidden{display:none;}
    .item{display:grid;grid-template-columns:auto 1fr;gap:8px;align-items:center;margin:6px 0;}
    .item-number{font-weight:bold;min-width:20px;text-align:right;}
    .item-text{padding:4px;border:1px solid #ccc;border-radius:4px;flex:1;}
    .checkbox-label{display:flex;align-items:center;gap:4px;}
    .controls{display:flex;gap:6px;flex-wrap:wrap;}
    .controls .group{display:flex;flex-wrap:wrap;gap:6px;}
    .remark-input{padding:4px;border:1px solid #ccc;border-radius:4px;}
    .categories-hidden{display:none!important;}
    .filter-box{margin:20px 0;padding:10px;background:#fff;border:1px solid #ccc;border-radius:6px;display:inline-block;}
    .month-summary{margin-top:10px;font-weight:bold;color:#333;background:#eef;padding:6px;border-radius:4px;}

    /* Lesson page */
    #lesson-input{width:100%;height:140px;font-size:1rem;padding:8px;box-sizing:border-box;}
    .lesson-wrapper{display:flex;gap:10px;}
    .lesson-card{flex:3;background:#fff;border:1px solid #bde;border-radius:6px;padding:12px;margin-bottom:15px;}
    .lesson-heading{font-weight:bold;font-size:1.1rem;margin-bottom:8px;}
    .lesson-time,.lesson-court{margin-bottom:6px;color:#444;}
    .lesson-cost{font-weight:bold;color:#0a881f;margin-bottom:8px;}
    .lesson-btn{background:#28a745;margin-right:5px;}
    .lesson-btn-del{background:#cc0000;margin-right:5px;}
    .lesson-calc{flex:1;padding:10px;border:1px dashed #555;background:#f8fff0;border-radius:6px;min-width:120px;}
    .lesson-month-summary{font-weight:bold;background:#e7f6ee;color:#27734b;padding:6px;border-radius:5px;margin:8px 0;}
    .lesson-filter{padding:10px;margin-bottom:10px;background:#fff;border:1px solid #ccc;border-radius:6px;}
  </style>
</head>
<body>

<div class="tab-bar">
  <button class="tab active" onclick="showPage('event')">üè∏ Event ÂêçÂñÆÁÆ°ÁêÜ</button>
  <button class="tab" onclick="showPage('lesson')">üìö Lesson Á¥ÄÈåÑ</button>
</div>

<!-- EVENT PAGE -->
<div class="page active" id="event-page">
  <h2>Add New Events</h2>
  <textarea id="inputText" placeholder="Paste events here..."></textarea><br>
  <button onclick="addList()">Add Event(s)</button>
  <button onclick="clearAll()">Clear All</button>
  <button class="pink-btn" onclick="toggleCategories()">Toggle Categories</button>
  <button class="pink-btn" onclick="toggleCalc()">Hide Calculation</button>
  <button onclick="exportJSON()">Export JSON</button>
  <button onclick="document.getElementById('importFile').click()">Import JSON</button>
  <button onclick="importJSONPrompt()">Import from Paste</button>
  <button onclick="copyJSON()">Copy JSON</button>
  <button onclick="copyEventData()">Copy Data (Input format)</button>
  <input id="importFile" type="file" accept="application/json" style="display:none" onchange="importJSONFile(event)">
  <div class="filter-box">
    <label>üîç Search Name: <input type="text" id="nameSearch" oninput="renderLists()"></label>
  </div>
  <div id="listsContainer"></div>
</div>

<!-- LESSON PAGE -->
<div class="page" id="lesson-page">
  <h2>üìö Lesson Á¥ÄÈåÑ</h2>
  <textarea id="lesson-input" placeholder="Â∑≤bookÂ†¥Á∑¥Ê≥¢\n10/9\nÁæéÊûóÈ´îËÇ≤È§®\n1400-1500\n4ËôüÂ†¥"></textarea><br>
  <button onclick="addLessons()">Add Lesson(s)</button>
  <button onclick="clearAllLessons()">Clear All Lessons</button>
  <button onclick="exportLessons()">Export JSON</button>
  <button onclick="importLessonsPrompt()">Import from Paste</button>
  <button onclick="copyLessons()">Copy JSON</button>
  <div class="lesson-filter">
    <label>üìÖ Filter Month: <select id="lessonMonthFilter" onchange="renderLessons()"><option value="">All</option></select></label>
    <label><input type="checkbox" id="lessonFutureOnly" onchange="renderLessons()"> Show Future Only</label>
  </div>
  <div id="lesson-list"></div>
</div>

<script>
/* Tab Navigation */
function showPage(page){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  if(page==='event'){document.querySelector('.tab:nth-child(1)').classList.add('active');document.getElementById('event-page').classList.add('active');renderLists();}
  else {document.querySelector('.tab:nth-child(2)').classList.add('active');document.getElementById('lesson-page').classList.add('active');renderLessons();}
}

/* ---------------- EVENT PAGE ---------------- */
let savedLists=JSON.parse(localStorage.getItem("savedLists")||"[]");
let categoriesVisible=true,calcVisible=true;
const categories=[{key:"Âø´Ê®Ç"},{key:"ËøëÂàù"},{key:"Âàù"},{key:"Âàù‰∏≠"}];

function renderLists(){
  const cont=document.getElementById("listsContainer");cont.innerHTML="";
  const search=document.getElementById("nameSearch").value.toLowerCase();
  savedLists.forEach((list,idx)=>{
    if(search && !list.items.some(it=>it.text.toLowerCase().includes(search))) return;
    const listDiv=document.createElement("div");listDiv.className="list";
    const hdiv=document.createElement("div");hdiv.className="list-header";
    const h=document.createElement("h3");h.textContent=list.header;hdiv.appendChild(h);
    const btns=document.createElement("div");btns.className="header-buttons";
    const del=document.createElement("button");del.textContent="Delete";del.className="danger";del.onclick=()=>{if(confirm("Delete?")){savedLists.splice(idx,1);save();renderLists();}};
    const cal=document.createElement("button");cal.textContent="Add to Calendar";cal.className="calendar-btn";cal.onclick=()=>addToGoogleCalendar(list.header,list.items);
    btns.append(del,cal);hdiv.appendChild(btns);listDiv.appendChild(hdiv);
    const wrap=document.createElement("div");wrap.className="event-wrapper";
    const content=document.createElement("div");content.className="event-content";
    list.items.forEach((item,i)=>{
      const row=document.createElement("div");row.className="item";
      const num=document.createElement("span");num.className="item-number";num.textContent=(i+1)+".";row.appendChild(num);
      const txt=document.createElement("input");txt.type="text";txt.value=item.text;txt.className="item-text";txt.oninput=()=>{item.text=txt.value;save();};row.appendChild(txt);
      const controls=document.createElement("div");controls.className="controls";
      const pw=document.createElement("label");pw.className="checkbox-label";const pb=document.createElement("input");pb.type="checkbox";pb.checked=item.payment;pb.onchange=()=>{item.payment=pb.checked;save();};pw.append(pb,"Payment");controls.appendChild(pw);
      const aw=document.createElement("label");aw.className="checkbox-label";const ab=document.createElement("input");ab.type="checkbox";ab.checked=item.arrive;ab.onchange=()=>{item.arrive=ab.checked;save();};aw.append(ab,"Arrive");controls.appendChild(aw);
      const group=document.createElement("div");group.className="group";if(!categoriesVisible)group.classList.add("categories-hidden");
      categories.forEach(c=>{const lab=document.createElement("label");const cb=document.createElement("input");cb.type="checkbox";cb.checked=item.categories?.[c.key]||false;cb.onchange=()=>{item.categories[c.key]=cb.checked;save();};lab.append(cb,c.key);group.appendChild(lab);});
      const remark=document.createElement("input");remark.type="text";remark.value=item.remark||"";remark.placeholder="Remark";remark.className="remark-input";remark.oninput=()=>{item.remark=remark.value;save();};group.appendChild(remark);
      controls.appendChild(group);row.appendChild(controls);content.appendChild(row);
    });
    wrap.appendChild(content);
    const calc=document.createElement("div");calc.className="calc-panel";if(!calcVisible)calc.classList.add("calc-hidden");calc.textContent="(calculation panel placeholder)";wrap.appendChild(calc);
    listDiv.appendChild(wrap);cont.appendChild(listDiv);
  });
}
function addList(){
  const input=document.getElementById("inputText").value.trim();if(!input)return;
  const blocks=input.split(/\n\s*\n/);
  blocks.forEach(block=>{
    const lines=block.split(/\r?\n/).filter(Boolean);if(lines.length<2)return;
    const header=lines[0];const items=lines.slice(1).map(l=>({text:l.replace(/^\d+[\.\s]*/,""),payment:false,arrive:false,remark:"",categories:{}}));
    if(items.length>0)savedLists.push({header,items});
  });save();document.getElementById("inputText").value="";renderLists();
}
function clearAll(){if(confirm("Clear all?")){savedLists=[];save();renderLists();}}
function save(){localStorage.setItem("savedLists",JSON.stringify(savedLists));}
function toggleCategories(){categoriesVisible=!categoriesVisible;renderLists();}
function toggleCalc(){calcVisible=!calcVisible;renderLists();}
function exportJSON(){const s=JSON.stringify(savedLists,null,2);const b=new Blob([s],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download="events.json";a.click();URL.revokeObjectURL(u);}
function importJSONFile(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(Array.isArray(d)){savedLists=d;save();renderLists();}else alert("Invalid JSON");}catch(err){alert(err);}};r.readAsText(f);}
function importJSONPrompt(){const t=prompt("Paste JSON:");if(!t)return;try{const d=JSON.parse(t);if(Array.isArray(d)){savedLists=d;save();renderLists();}}catch(e){alert(e);}}
function copyJSON(){navigator.clipboard.writeText(JSON.stringify(savedLists,null,2)).then(()=>alert("‚úÖ Copied"));}
function copyEventData(){let txt="";savedLists.forEach(l=>{txt+=l.header+"\n";l.items.forEach((it,i)=>txt+=(i+1)+". "+it.text+"\n");txt+="\n";});navigator.clipboard.writeText(txt.trim()).then(()=>alert("‚úÖ Copied in input format"));}
function addToGoogleCalendar(headerText,items){alert("Google Calendar link for: "+headerText);} /* simplified */

/* ---------------- LESSON PAGE ---------------- */
let lessonData=JSON.parse(localStorage.getItem("lessonData")||"[]");
function parseLessonBlock(block){
  let lines=block.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  if(lines[0].includes("Â∑≤bookÂ†¥")) lines.shift();
  if(lines.length<4) return null;
  const [dateStr, locRaw, timeStr, court]=lines;
  const location=locRaw.replace(/È´îËÇ≤È§®/g,"");
  const dm=dateStr.match(/(\d{1,2})[\/\-](\d{1,2})/);if(!dm)return null;
  const month=+dm[1],day=+dm[2];
  const tm=timeStr.match(/(\d{2})(\d{2})-(\d{2})(\d{2})/);if(!tm)return null;
  const sh=+tm[1], sm=+tm[2], eh=+tm[3], em=+tm[4];
  const eventName=`${location}‰∏äÂ†Ç ${court}`;
  return {month,day,startHour:sh,startMinute:sm,endHour:eh,endMinute:em,location,court,eventName};
}
function addLessons(){
  const txt=document.getElementById("lesson-input").value.trim();if(!txt)return;
  const blocks=txt.split(/\n\s*\n/).filter(Boolean);
  blocks.forEach(b=>{const l=parseLessonBlock(b);if(l)lessonData.push(l);});
  localStorage.setItem("lessonData",JSON.stringify(lessonData));document.getElementById("lesson-input").value="";renderLessons();
}
function renderLessons(){
  const cont=document.getElementById("lesson-list");cont.innerHTML="";
  if(!lessonData.length){cont.innerHTML="<div style='color:#888'>Ê≤íÊúâË™≤Â†ÇÁ¥ÄÈåÑ</div>";return;}
  const sel=document.getElementById("lessonMonthFilter");
  const months=[...new Set(lessonData.map(l=>l.month))];sel.innerHTML="<option value=''>All</option>";months.forEach(m=>{const o=document.createElement("option");o.value=m;o.textContent=m+"Êúà";sel.appendChild(o);});
  const fMonth=sel.value;const futureOnly=document.getElementById("lessonFutureOnly").checked;
  lessonData.sort((a,b)=>a.month-b.month||a.day-b.day||a.startHour-b.startHour);
  let current=null,sum=0;
  lessonData.forEach((l,idx)=>{
    const d=new Date(new Date().getFullYear(),l.month-1,l.day,l.startHour,l.startMinute);
    if(fMonth && l.month.toString()!==fMonth)return;
    if(futureOnly && d<new Date())return;
    if(current && current!==l.month){const sd=document.createElement("div");sd.className="lesson-month-summary";sd.textContent=current+"ÊúàÂêàÂÖ±Ôºö"+sum;cont.appendChild(sd);sum=0;}
    current=l.month;
    const wrap=document.createElement("div");wrap.className="lesson-wrapper";
    const card=document.createElement("div");card.className="lesson-card";card.innerHTML=`<div class="lesson-heading">${l.month}Êúà${l.day}Êó• ${l.location}</div><div class="lesson-time">${pad(l.startHour)}:${pad(l.startMinute)}~${pad(l.endHour)}:${pad(l.endMinute)}</div><div class="lesson-court">${l.court}</div>`;
    const btn=document.createElement("button");btn.textContent="Add to Calendar";btn.className="lesson-btn";btn.onclick=()=>addLessonToCalendar(l);card.appendChild(btn);
    const del=document.createElement("button");del.textContent="‚úñ Âà™Èô§";del.className="lesson-btn-del";del.onclick=()=>{if(confirm("Delete?")){lessonData.splice(idx,1);localStorage.setItem("lessonData",JSON.stringify(lessonData));renderLessons();}};card.appendChild(del);
    wrap.appendChild(card);
    const calc=document.createElement("div");calc.className="lesson-calc";const dur=(l.endHour*60+l.endMinute-(l.startHour*60+l.startMinute))/60;const cost=dur*260;calc.textContent=`ÊôÇÊï∏:${dur}h √ó 260 = $${cost}`;sum+=cost;wrap.appendChild(calc);
    cont.appendChild(wrap);
  });
  if(current){const sd=document.createElement("div");sd.className="lesson-month-summary";sd.textContent=current+"ÊúàÂêàÂÖ±Ôºö"+sum;cont.appendChild(sd);}
}
function addLessonToCalendar(l){
  const s=new Date(new Date().getFullYear(),l.month-1,l.day,l.startHour,l.startMinute);
  const e=new Date(new Date().getFullYear(),l.month-1,l.day,l.endHour,l.endMinute);
  const fmt=d=>d.toISOString().replace(/-|:|\.\d+/g,"");
  const title=l.eventName;
  const url="https://calendar.google.com/calendar/render?action=TEMPLATE&text="+encodeURIComponent(title)+"&dates="+fmt(s)+"/"+fmt(e);
  window.open(url,'_blank');
}
function pad(n){return n<10?"0"+n:n;}
function clearAllLessons(){if(confirm("Clear all lessons?")){lessonData=[];localStorage.removeItem("lessonData");renderLessons();}}
function exportLessons(){const s=JSON.stringify(lessonData,null,2);const b=new Blob([s],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download="lessons.json";a.click();URL.revokeObjectURL(u);}
function copyLessons(){navigator.clipboard.writeText(JSON.stringify(lessonData,null,2)).then(()=>alert("‚úÖ Copied"));}
function importLessonsPrompt(){const t=prompt("Paste JSON:");if(!t)return;try{const d=JSON.parse(t);if(Array.isArray(d)){lessonData=d;localStorage.setItem("lessonData",JSON.stringify(d));renderLessons();}}catch(e){alert(e);}}

window.addEventListener("load",()=>{renderLists();renderLessons();});
</script>
</body>
</html>